<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="{{url_for('static',filename='style.css') }}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container">
      <div class="search-input">
        <!-- <label for="search">Search for item ...</label> -->
        <input
          id="search"
          name="search"
          type="text"
          class="form-control"
          placeholder="search for item ..."
        />
      </div>
      <div class="item-table">
        <div class="card">
          <h1>Items</h1>
          <div class="meta">
            Columns: <span class="tag">id</span> <span class="tag">name</span>
            <span class="tag">cost</span> <span class="tag">sell</span>
          </div>

          <div class="table-wrap">
            <table id="itemsTable" aria-label="items table">
              <thead>
                <tr>
                  <th data-key="id">ID</th>
                  <th data-key="name">Name</th>
                  <th data-key="cost">Cost (USD)</th>
                  <th data-key="sell">Sell (USD)</th>
                </tr>
              </thead>
              <tbody>
                <!-- rows will be injected by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    // sample data
    const data = [
      { id: 1, name: "Test Product", cost: 10.0, sell: 15.0 },
      { id: 2, name: "Olive Oil 1L", cost: 5.5, sell: 8.75 },
      { id: 3, name: "Arabic Coffee Pack", cost: 3.2, sell: 5.0 },
      { id: 4, name: "Premium Dates Box", cost: 12.0, sell: 18.5 },
      { id: 5, name: "Handmade Soap", cost: 1.75, sell: 3.5 },
      { id: 6, name: "Wool Shawl", cost: 22.0, sell: 35.0 },
    ];

    const tbody = document.querySelector("#itemsTable tbody");

    function formatCurrency(n) {
      // keep 2 decimals, local formatting
      return n.toLocaleString(undefined, {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      });
    }

    function renderRows(rows) {
      tbody.innerHTML = rows
        .map(
          (r) => `
        <tr>
          <td class="id-col">${r.id}</td>
          <td class="name-col">${escapeHtml(r.name)}</td>
          <td class="num">${formatCurrency(r.cost)}</td>
          <td class="num">${formatCurrency(r.sell)}</td>
        </tr>
      `
        )
        .join("");
    }

    // simple HTML escaper (safe for this demo)
    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // initial render
    renderRows(data);

    // Sorting support
    let sortState = { key: null, dir: 1 }; // dir: 1 asc, -1 desc
    document.querySelectorAll("#itemsTable thead th").forEach((th) => {
      th.addEventListener("click", () => {
        const key = th.dataset.key;
        // toggle
        if (sortState.key === key) sortState.dir *= -1;
        else {
          sortState.key = key;
          sortState.dir = 1;
        }

        // remove sort markers
        document
          .querySelectorAll("#itemsTable thead th")
          .forEach((h) => h.classList.remove("sort-asc", "sort-desc"));

        if (sortState.dir === 1) th.classList.add("sort-asc");
        else th.classList.add("sort-desc");

        const sorted = data.slice().sort((a, b) => {
          let av = a[key],
            bv = b[key];
          // numeric if id/cost/sell
          if (typeof av === "number" && typeof bv === "number")
            return (av - bv) * sortState.dir;
          // fallback string compare
          return av.toString().localeCompare(bv.toString()) * sortState.dir;
        });
        renderRows(sorted);
      });
    });
  </script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"
  ></script>
</html>
